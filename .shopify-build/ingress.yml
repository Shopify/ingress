containers:
  default:
    docker: quay.io/kubernetes-ingress-controller/e2e:v06262019-ecce3fd7b
  prow:
    docker: quay.io/kubernetes-ingress-controller/e2e-prow:v06292019-7c6ffeaea

steps:
- label: Static Check
  timeout: 5m
  run:
  - build/static-check.sh
  env:
    PKG: Shopify/ingress

- label: Lua unit test
  timeout: 5m
  run:
  - build/test-lua.sh
  env:
    BUSTED_ARGS: -v --pattern=_test

- label: Go unit test
  timeout: 15m
  run:
  - mkdir -p $GOPATH/src/$PKG
  - cp -r /app/* $GOPATH/src/$PKG/
  - cd $GOPATH/src/$PKG && build/cover.sh
  env:
    PKG: k8s.io/ingress-nginx

- label: E2e test
  timeout: 35m
  run:
  - build/shopify-e2e
  env:
    E2E_NODES: "10"
    K8S_VERSION: "v1.12.9"
    REPO_INFO: "https://github.com/Shopify/ingress"
  container: prow
